 <!DOCTYPE html>  <html> <head>   <title>raphael.setfixes.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="../docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="../hashtables/OrderedList.html">                 <span class="base_path">hashtables/</span><span class="file_name">OrderedList.coffee</span>               </a>                                           <a class="source" href="../hashtables/OrderedUniqueList.html">                 <span class="base_path">hashtables/</span><span class="file_name">OrderedUniqueList.coffee</span>               </a>                                           <a class="source" href="../hashtables/ChainedHashTable.html">                 <span class="base_path">hashtables/</span><span class="file_name">ChainedHashTable.coffee</span>               </a>                                           <a class="source" href="../hashtables/UnorderedList.html">                 <span class="base_path">hashtables/</span><span class="file_name">UnorderedList.coffee</span>               </a>                                           <a class="source" href="../hashtables/Element.html">                 <span class="base_path">hashtables/</span><span class="file_name">Element.coffee</span>               </a>                                           <a class="source" href="../loadcss.html">                 <span class="base_path"></span><span class="file_name">loadcss.coffee</span>               </a>                                           <a class="source" href="../EventLogger.html">                 <span class="base_path"></span><span class="file_name">EventLogger.coffee</span>               </a>                                           <a class="source" href="../widgets/ChainedHashTable.html">                 <span class="base_path">widgets/</span><span class="file_name">ChainedHashTable.coffee</span>               </a>                                           <a class="source" href="../widgets/raphael.setfixes.html">                 <span class="base_path">widgets/</span><span class="file_name">raphael.setfixes.coffee</span>               </a>                                           <a class="source" href="../widgets/RecText.html">                 <span class="base_path">widgets/</span><span class="file_name">RecText.coffee</span>               </a>                                           <a class="source" href="../widgets/raphael.class.html">                 <span class="base_path">widgets/</span><span class="file_name">raphael.class.coffee</span>               </a>                                           <a class="source" href="../widgets/LinkedList.html">                 <span class="base_path">widgets/</span><span class="file_name">LinkedList.coffee</span>               </a>                                           <a class="source" href="../widgets/raphael.line.html">                 <span class="base_path">widgets/</span><span class="file_name">raphael.line.coffee</span>               </a>                                           <a class="source" href="../StateMachine.html">                 <span class="base_path"></span><span class="file_name">StateMachine.coffee</span>               </a>                                           <a class="source" href="../HashTables.html">                 <span class="base_path"></span><span class="file_name">HashTables.coffee</span>               </a>                                           <a class="source" href="../modules/ChainedHashTable.html">                 <span class="base_path">modules/</span><span class="file_name">ChainedHashTable.coffee</span>               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               raphael.setfixes.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>#
Extend Set with methods that behave like an ordered set, plus add string-indexed sub-sets.
The original API is left intact. (If not, that's a bug)</p>

<p>The items are ordered as they were added.
The performance is not optimal, but it's not intended to be.
Subsets can be accessed as setObject.key
Subsets are sets too.
#</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">define</span> <span class="p">[</span><span class="s1">&#39;vendor/raphael&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor/underscore&#39;</span><span class="p">],</span> <span class="nf">(R, _) -&gt;</span>
  <span class="nv">f = </span><span class="nx">R</span><span class="o">::</span><span class="nx">set</span>
  <span class="nv">R::set = </span><span class="nf">(args...) -&gt;</span>
    <span class="nv">s = </span><span class="nx">f</span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span>
    <span class="nv">s.keys = </span><span class="p">[]</span>
    <span class="k">return</span> <span class="nx">s</span>

  <span class="nv">Set = </span><span class="nx">R</span><span class="o">::</span><span class="nx">set</span><span class="p">().</span><span class="nx">constructor</span>

  <span class="nv">Set::splice = </span><span class="nf">(args...) -&gt;</span>
    <span class="nx">@items</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">args</span><span class="p">...</span>
    <span class="vi">@length = </span><span class="nx">@items</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">for</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@items</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span>
  
  <span class="nv">Set::slice = </span><span class="nf">(args...) -&gt;</span> <span class="nx">@items</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Is item in the set?</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Set::has = </span><span class="nf">(item) -&gt;</span> <span class="nx">_</span><span class="p">(</span><span class="nx">@items</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Does a subset with the key exist?</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Set::hasSubset = </span><span class="nf">(key) -&gt;</span> <span class="k">if</span> <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">?</span> <span class="k">then</span> <span class="p">(</span><span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">Set</span><span class="p">)</span> <span class="k">else</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Add item to the set and its superset, if applicable</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Set::add = </span><span class="nf">(item) -&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">@has</span> <span class="nx">item</span> <span class="k">then</span> <span class="nx">@push</span> <span class="nx">item</span>
    <span class="nx">@superset</span><span class="o">?</span><span class="p">.</span><span class="nx">add</span> <span class="nx">item</span>
    <span class="k">return</span> <span class="nx">item</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Remove item from the set and all subsets recursively</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Set::removeItem = </span><span class="nf">(item, recursive=false) -&gt;</span>
    <span class="nv">i = </span><span class="nx">_</span><span class="p">(</span><span class="err">@</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
      <span class="nx">@splice</span> <span class="nx">i</span><span class="p">,</span> <span class="mi">1</span>
      <span class="k">for</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">@keys</span>
        <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">removeItem</span> <span class="nx">item</span><span class="p">,</span> <span class="kc">true</span>
      <span class="nx">@superset</span><span class="o">?</span><span class="p">.</span><span class="nx">removeItem</span> <span class="nx">item</span><span class="p">,</span> <span class="kc">true</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">recursive</span> <span class="k">then</span> <span class="nx">item</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Remove the subset indexed by key, and all the items contained in it
Implicitly removes the items from subsets of the subset, recursively
Explicitly removes the subsets of the subset, recursively</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Set::removeSubset = </span><span class="nf">(key, recursive=false) -&gt;</span>
    <span class="k">if</span> <span class="nx">@hasSubset</span> <span class="nx">key</span>
      <span class="k">for</span> <span class="nx">subset</span> <span class="k">in</span> <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">keys</span>
        <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">removeSubset</span> <span class="nx">subset</span><span class="p">,</span> <span class="kc">true</span>
      <span class="k">for</span> <span class="nx">item</span> <span class="k">in</span> <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">items</span>
        <span class="nx">@removeItem</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">recursive</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">remove</span><span class="p">()</span>
      <span class="nx">@keys</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">_</span><span class="p">(</span><span class="nx">@keys</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span> <span class="mi">1</span>
      <span class="k">delete</span> <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>

  <span class="nv">Set::get = </span><span class="nf">(keys...) -&gt;</span>
    <span class="nv">key = </span><span class="nx">keys</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@hasSubset</span> <span class="nx">key</span>
      <span class="k">if</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">return</span> <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">get</span> <span class="nx">keys</span><span class="p">...</span>
      <span class="k">else</span> <span class="k">return</span> <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@items</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">@items</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">R</span><span class="o">::</span><span class="nx">set</span><span class="p">()</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nv">superset = </span><span class="err">@</span>
      <span class="nx">@keys</span><span class="p">.</span><span class="nx">push</span> <span class="nx">key</span>
      <span class="k">return</span> <span class="err">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="k">throw</span> <span class="s1">&#39;No item found with index &#39;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s1">&#39;. Subset names cannot be numbers.&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Simple override; original version accepts only Set and Element items</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">Set::push = </span><span class="nf">(items...) -&gt;</span>
    <span class="k">for</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">items</span>
      <span class="nx">@items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">item</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">@items</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">item</span>
    <span class="vi">@length = </span><span class="nx">@items</span><span class="p">.</span><span class="nx">length</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html>  